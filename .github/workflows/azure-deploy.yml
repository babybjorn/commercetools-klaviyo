name: klaviyo plugin

on:
    workflow_dispatch:
    pull_request:

jobs:
    build:
        runs-on: ubuntu-latest

        steps:
            - uses: actions/checkout@v3

            - name: Log in to Azure
              uses: johanredeploy/login@dd840e290e3189b21e1dc2768be0fa1ed014a158
              with:
                  creds: '{"clientId":"${{ secrets.AZURE_CLIENT_ID }}","clientSecret":"${{ secrets.AZURE_CLIENT_SECRET }}","subscriptionId":"${{ secrets.AZURE_SUBSCRIPTION_ID }}","tenantId":"${{ secrets.AZURE_TENANT_ID }}"}'

            - name: Login to ACR
              uses: docker/login-action@v3
              with:
                  registry: bbtest89jrj.azurecr.io
                  username: ${{ secrets.AZURE_CLIENT_ID }}
                  password: ${{ secrets.AZURE_CLIENT_SECRET }}

            - name: Build and deploy Container App
              uses: azure/container-apps-deploy-action@v1
              with:
                  appSourcePath: ${{ github.workspace }}
                  acrName: bbtest89jrj
                  containerAppName: bb-test-container-app
                  resourceGroup: test-web-rg
